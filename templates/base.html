{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    {% block title %} {% endblock title %}
    <style>
        .nav-link{
            font-size: 22px;
            line-height: 24px;
            font-weight: 500;
        }
        #submitButton{
            font-size: 22px;
            font-weight: 500;
            line-height: 28px;
        }
    </style>
    {% block css %} {% endblock css %}

</head>
<body>
    {% include 'navbar.html' %}
    
    <div class="container mt-5">
        {% block content %} {% endblock content %}
    </div>
    {% include 'footer.html' %}

    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    {% if debug %}
    <script src="{% static 'js/vue.js' %}"></script>
    {% else %}
    <script src="{% static 'js/vue.min.js' %}"></script>
    {% endif %}

    <script>
        var app = new Vue({
            el: "#app",
            delimiters: ['[[', ']]'],
            data: {
                name: '',
                fatherName: '',
                mother_mame: '',
                dateOfBirth: '',
                forMan: true,
                forWomen: false,
                forOther: false,
                email: '',
                phone: '',
                address: '',
                gender: '',
                errorDate: '',
                valid_email:'',
                valid_phone: ''
    
            },
            mounted: function () {
                this.checkGender();
            },
            methods: {
                checkGender: function () {
                    var that = this;
                    if (that.forMan == true) {
                        that.gender = "Man";
                    }
                    if (that.forWoan == true) {
                        that.gender = "Women";
                    }
                    if (that.forOther == true) {
                        that.gender = "Other";
                    }
                },
                dateValidation:function(){
                    let today = new Date().toISOString().slice(0, 10)
                    if (Date.parse(this.dateOfBirth) > Date.parse(today)){
                        this.errorDate = "Date will not be more than today";
                    }
                },
                emailValidation: function(){
                    filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                    if (filter.test(this.email)) {
                        this.valid_email = "Email is valid "
                        $("#email").addClass('text-success');
                        $("#email").removeClass('text-danger');
                        $("#submitButton").attr('disabled', false);

                    }
                    else {
                        this.valid_email = 'Please enter valid email';
                        $("#email").removeClass('text-success');
                        $("#email").addClass('text-danger');
                        $("#submitButton").attr('disabled', true);
                    }
                   
                },
                phoneValidation: function () {
                    
                    var phoneno = /(^(\+8801|8801|01|008801))[1|3-9]{1}(\d){8}$/
                    if (this.phone.match(phoneno)) {
                        this.valid_phone = 'Phone number is valid'
                        var valid = $("#valid")
                        valid.addClass('text-success')
                        valid.removeClass('text-danger')
                        $("#submitButton").attr('disabled', false);


                    }
                    else {
                        this.valid_phone = 'Please enter valid phone number';
                        var valid = $("#valid");
                        valid.addClass('text-danger')
                        valid.removeClass('text-success')
                        $("#submitButton").attr('disabled', true);

                    }
                },
                onSubmit: function () {
                    var $crf_token = $('[name="csrfmiddlewaretoken"]').attr('value');
                    var formData = {};
                    console.log(this.motherName);
                    formData.name = this.name;
                    // formData.mother_mame = this.mother_mame;
                    formData.father_name = this.fatherName;
                    formData.date_of_birth = this.dateOfBirth;
                    formData.gender = this.gender;
                    formData.email = this.email;
                    formData.phone = this.phone;
                    formData.address = this.address;
                    console.log(formData)
                    $.ajax({
                        method: 'POST',
                        url: 'api/registration',
                        data: JSON.stringify(formData),
                        contentType: 'application/json',
                        headers: { "X-CSRFToken": '{{csrf_token}}' },
                    }).then((response) => {
                        alert('Successfuly Registration');
                        location.href = '/'
    
                    }).catch(errors => {
                        console.log(errors);
                    })
    
                }
    
            },
    
        });
    </script>
    {% block js %} {% endblock js %}
</body>
</html>